<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title> Running Docker on Azure (For Windows Users) |  all&amp;all </title>
	<link href="/resources/css/site.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet" type="text/css">
</head>
<body>
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54331578-1', 'auto');
  ga('send', 'pageview');

</script>
	<div class="l-wrap">
		<header class="l-hd">
			<h2 class="l-hd-name"><a href="/" class="l-hd-name-link">all&all</a></h2>
		</header>
		<section>


<div class="stry">
<h1>Running Docker + Nodejs on Azure (For Windows Users)</h1>

<p>To begin with, let's start by <a href="https://www.vagrantup.com/downloads">downloading the latest version of vagrant</a>. At the time of writing, thats vagrant v1.6.4.</p>

<h3>Wait, Why Not Boot2Docker?</h3>

<p>If you go to the docker download page, for windows users it recommmends boot2docker. Thus I had started doing this via boot2docker and quickly noticed that it had terrible limitations. (Boot2docker is a very lightweight linux vm).</p>

<p>Limitations i didnt like:</p>

<ul>
<li>you can't externally run dockerfiles (will discuss later what this is)</li>
<li>starting it would work sometimes, fail other times</li>
<li>can't download packages into its VM (no apt-get)</li>
<li>can't share files in and out of it (have to make all files in the VM)</li>
<li>only text editor pre-installed is vi (not for me)</li>
</ul>


<p>So we'll use vagrant.</p>

<h3>Setting Up Vagrant</h3>

<p><em>Note-- I use git bash instead of powershell/cmd.</em></p>

<p>Pretty simple, just walk through the install and restart your computer when needed at the end.</p>

<p>Let's create a directory for our future code:</p>

<ul>
<li><code>mkdir src</code></li>
</ul>


<p>Let's create a directory for our VM work:</p>

<ul>
<li><code>mkdir devops</code></li>
<li><code>cd devops</code></li>
</ul>


<p>To create an initial Vagrantfile we run:</p>

<ul>
<li><code>vagrant init</code></li>
</ul>


<p>A Vagrantfile is a script that creates a linux vm for us to run docker from. We need to do this because its not possible to currently run docker from windows directly. Let's see whats in our Vagrantfile:</p>

<ul>
<li><code>cat Vagrantfile</code> (outputs Vagrantfile to the screen)</li>
</ul>


<p>... wayyyyyy too much we're not going to get into here. So lets skip straight to making our vagrant setup.</p>

<h3>1. Setting Up Our VM OS</h3>

<p>Let's use precise32, its a super-well known ubuntu image for Vagrant. To do so, swap the line <code>config.vm.box = "base"</code> with <code>config.vm.box = "hashicorp/precise32"</code>. While doing this for a docker based vagrant vm isnt required, at times i've gotten errors not doing so.</p>

<h3>2. Configuring VM Settings</h3>

<p>At the end of the Vagrantfile, copy the following ruby code:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>  
  <span class="c1"># set up our source syncing</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;../src&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/src&quot;</span>

  <span class="c1"># set up our docker file location</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;docker&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
    <span class="n">d</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>


<p>This config addition adds two things:</p>

<ol>
<li>Our src directory is now synced onto our vagrant linux vm</li>
<li>Our vagrant box is setup for future docker usage</li>
</ol>


<p>After all that, run <code>vagrant up</code>. This will run through the Vagrantfile's instructions, which now include downloading and setting up the ubuntu image.</p>

<p><img src="/resources/img/docker-01.jpg" alt="running vagrant up" /></p>

<p>If at the end of the cmd you get the error "The executable 'bsdtar' Vagrant is trying to run was not found in the %PATH% variable" then add <code>C:\HashiCorp\Vagrant\embedded\mingw\bin</code> to your PATH and try again.</p>

<h3>3. Create Our Dockerfile</h3>

<p>You can think of a Dockerfile as "steps to create my linux VM." This is a GREAT practice to get into, since frequently production code breaks and having a script to regenerate VMs greatly decreases the amount of time it takes to fix production issues in those scenarios.</p>

<p>Open a text editor in the devops directory and let's make a file named "Dockerfile".</p>

<p>Contents of our Dockerfile:</p>

</div>
<div class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'micahasmith'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

</div>

		</section>
		
	</div>

	<footer class="l-ft">
			<p class="l-ft-copy">&copy; Micah Smith Brooklyn, Ny 
				| <a rel="me" href="https://twitter.com/micahsays" class="l-ft-social">Twitter</a> 
				| <a rel="me" href="https://www.github.com/micahasmith" class="l-ft-social">Github</a>

			</p>
	<footer>
</body>
</html>
